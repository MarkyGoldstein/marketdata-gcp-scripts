steps:
# This single step performs all actions and includes debugging output.
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    # Exit immediately if a command fails
    set -e

    echo "--- Initializing submodule ---"
    git submodule update --init --recursive

    echo "--- DEBUG: Listing contents of gcr-cleaner directory ---"
    ls -laR gcr-cleaner

    echo "--- Starting docker build ---"
    # Change into the submodule's directory and build from there.
    cd gcr-cleaner && docker build \
      -t 'europe-west6-docker.pkg.dev/crm-incoming-data-and-enrich/cloud-run-source-deploy/gcr-cleaner:latest' \
      .

# Explicitly declare the image that this build produces.
images:
- 'europe-west6-docker.pkg.dev/crm-incoming-data-and-enrich/cloud-run-source-deploy/gcr-cleaner:latest'

# This 'options' block is required when using a custom service account.
options:
  logging: 'CLOUD_LOGGING_ONLY'